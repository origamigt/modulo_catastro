<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:comp="http://xmlns.jcp.org/jsf/composite/dialog"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:define name="head">
        <style type="text/css" >
            .ui-selectoneradio label{
                font-size: 1em;
                font-weight: bold;
            }
            .ui-selectmanycheckbox label{
                font-size: 1.3em;
                font-weight: bold;
            }
            .ui-fieldset, .ui-fieldset .ui-fieldset-legend {
                padding: 1.5px 1em;
            }
            /*            .ui-datatable.borderless thead th,
                        .ui-datatable.borderless tbody,
                        .ui-datatable.borderless tbody tr,
                        .ui-datatable.borderless tbody td {
                            border-style: none;
                        }*/

            .vd-hidden-column {
                display: none;
                width: 0;
                height: 0;
            }
            .ui-tooltip {
                border: 1px solid #ccc;
                box-shadow: 0 0 10px 0 #ddd;
                -moz-box-shadow: 0 0 10px 0 #ddd;
                -webkit-box-shadow: 0 0 10px 0 #ddd;
                color: #666;
                background: #f8f8f8;
                opacity: 1;
                font-size: 9px !important;
            }
            .ui-tooltip-content {
                font-size: 9px !important;
            }
        </style>
    </ui:define>
    <ui:define name="content">
        <style>
            .colored {
                background-color: #B8B8B8 !important ; 
            }
            .propiedadHorizontal {
                /*background-color: #57f5f0 !important ;*/ 
                background-color: #AFEEEE !important ; 
            }
            .tarea {
                background-color: #90EE90 !important ; 
            }
        </style>
        <h:form id="frmPredios">
            <div align="center" class="ui-g-6 ui-md-6" >
                <h1>Listado de predios</h1>
            </div>

            <div align="center">
                <p:selectOneRadio value="#{gestionPredios.tipoPredio}" >
                    <f:selectItem itemLabel="Todos" itemValue="#{null}" />
                    <f:selectItem itemLabel="Predios Urbanos" itemValue="U" />
                    <f:selectItem itemLabel="Predios Rusticos" itemValue="R" />
                    <p:ajax listener="#{gestionPredios.consultaTipoPredio()}" update="dtPredios"/>
                </p:selectOneRadio>
            </div>
            <p:tabView id="tbConsultas" dynamic="true" >
                <p:tab title="TIPO DE CONSULTA" id="tab1">
                    <p:selectOneRadio id="optconsult" value="#{gestionPredios.optFiltro}" class="Fs10" >
                        <f:selectItem itemLabel="Matricula Inmobiliaria" itemValue="1"/>
                        <f:selectItem itemLabel="Propietario" itemValue="2" />
                        <f:selectItem itemLabel="Código Anterior 2" itemValue="3" rendered="#{appConfig.mainConfig.fichaPredial.redenerFichaIb}" />
                        <f:selectItem itemLabel="Código Catastral " itemValue="4"/>
                        <f:selectItem itemLabel="Código Anterior" itemValue="5"/>
                        <f:selectItem itemLabel="Propiedades Horizontales" itemValue="6"/>
                        <p:ajax listener="#{gestionPredios.filtrar()}" update="frmPredios:tbConsultas"/>
                    </p:selectOneRadio>
                    <h:panelGrid columns="4" style="width: 100% ">
                        <p:fieldset legend="CÓDIGO ÚNICO" style="font-size: 13px;" rendered="#{gestionPredios.optFiltro eq 1}">
                            <p:outputLabel value="CÓDIGO ÚNICO: " style="font-size: 13px; font-weight: bolder;"/>
                            <p:inputText value="#{gestionPredios.predioModel.numPredio}" style="font-size: 13px; font-weight: bolder;"/>
                        </p:fieldset>
                        <p:fieldset legend="CONTRIBUYENTE" style="font-size: 13px; width: 97% !important" rendered="#{gestionPredios.optFiltro eq 2 and !appConfig.mainConfig.fichaPredial.redenerFichaIb}">
                            <p:outputLabel value="C.I./R.U.C.: " style="font-size: 13px; font-weight: bolder; width: 140px;"/>
                            <p:outputLabel value="CONTRIBUYENTE: " style="font-size: 13px; font-weight: bolder;"/>
                            <br/>
                            <p:inputText value="#{gestionPredios.contribuyenteConsulta.ciRuc}" style="font-size: 13px; font-weight: bolder;" size="15" readonly="true"/>
                            <p:spacer width="10"/>
                            <p:inputText value="#{gestionPredios.contribuyenteConsulta.apellidos} #{gestionPredios.contribuyenteConsulta.nombres} #{gestionPredios.contribuyenteConsulta.razonSocial} #{gestionPredios.contribuyenteConsulta.nombreComercial}" style="font-size: 13px; font-weight: bolder;" readonly="true" size="50"/>
                            <p:spacer width="10"/>
                            <p:commandButton id="btnCambiarBuscar" value="Listar" style="height: 30px" onclick="PF('dlgSolicitante').show()" />
                        </p:fieldset>
                        <p:fieldset id="fieldCiudada" legend="PROPIETARIO" style="font-size: 13px;" rendered="#{gestionPredios.optFiltro eq 2 and appConfig.mainConfig.fichaPredial.redenerFichaIb}">
                            <h:panelGrid columns="3">
                                <h:panelGroup layout="block" >
                                    <p:outputLabel value="C.I./R.U.C.: " style="font-size: 13px; font-weight: bolder; width: 140px;" class="FontBold DispBlock Wid100"/>
                                    <p:inputText value="#{gestionPredios.responsable.ciuCedRuc}" style="font-size: 13px; font-weight: bolder;" size="15" readonly="true"/>
                                </h:panelGroup>
                                <h:panelGroup layout="block" >
                                    <p:outputLabel value="DESCRIPCIÓN " style="font-size: 13px; font-weight: bolder;" class="FontBold DispBlock Wid100"/>
                                    <p:inputText value="#{gestionPredios.responsable.ciuApellidoPat} #{gestionPredios.responsable.ciuApellidoMat} #{gestionPredios.responsable.ciuPrimerNombre} #{gestionPredios.responsable.ciuSegundoNombre}" style="font-size: 13px; font-weight: bolder;" readonly="true" size="50"/>
                                </h:panelGroup>
                                <p:commandButton id="btnBuscarCiud" value="Listar" style="height: 30px" actionListener="#{gestionPredios.loadResponsablesPredio()}" >
                                    <p:ajax event="dialogReturn" listener="#{gestionPredios.selectedResponsableCiudadano}" update="frmPredios:dtPredios, frmPredios:tbConsultas:fieldCiudada"/>
                                </p:commandButton>
                            </h:panelGrid>
                        </p:fieldset>
                        <p:fieldset legend="URBANIZACION-MZ/SL" style="font-size: 13px;" rendered="false">
                            <p:panelGrid styleClass="noBorder">
                                <p:row>
                                    <p:column><p:outputLabel value="URBANIZACION" style="font-size: 13px; font-weight: bolder;"/></p:column>
                                    <p:column><p:outputLabel value="MANZANA" style="font-size: 13px; font-weight: bolder;"/></p:column>
                                    <p:column><p:outputLabel value="LOTE" style="font-size: 13px; font-weight: bolder;"/></p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:selectOneMenu  value="#{gestionPredios.predioModel.ciudadela}" effect="fade" converter="entityConverter"  style="width:200px;" filter="true" filterMatchMode="contains">
                                            <f:selectItem itemLabel="Seleccionar..." itemValue="#{null}"/>
                                            <f:selectItems value="#{gestionPredios.ciudadelas}" var="c" itemLabel="#{c.nombre}" itemValue="#{c}"/>
                                        </p:selectOneMenu>
                                    </p:column>
                                    <p:column><p:inputText value="#{gestionPredios.predioModel.mzUrb}"/></p:column>
                                    <p:column><p:inputText value="#{gestionPredios.predioModel.slUrb}"/></p:column>
                                </p:row>
                            </p:panelGrid>
                        </p:fieldset>
                        <p:fieldset legend="CÓDIGO CATASTRAL" style="font-size: 13px;" rendered="#{gestionPredios.optFiltro eq 4}">
                            <p:panelGrid id="codigoCatastral" columns="2" styleClass="ui-responsive" style="width: 100%">
                                <p:outputLabel value="Clave Catastral" style="width: 95%"/>
                                <p:inputText id="unid" placeholder="Código Predial" value="#{gestionPredios.predioModel.codigoPredial}" style="width: 95%" maxlength="24"/>
                            </p:panelGrid>
                        </p:fieldset>
                        <p:fieldset legend="CÓDIGO ANTERIOR 2" style="font-size: 13px;" rendered="#{gestionPredios.optFiltro eq 3 and appConfig.mainConfig.fichaPredial.redenerFichaIb}">
                            <p:panelGrid id="codigoAnterior2" columns="2" styleClass="ui-responsive" style="width: 100%">
                                <p:outputLabel value="Código Anterior 2" style="width: 95%"/>
                                <p:inputText id="codAnt2" placeholder="Código Anterior 2" value="#{gestionPredios.predioModel.predialAnt}" style="width: 95%" maxlength="24"/>
                            </p:panelGrid>
                        </p:fieldset>
                        <p:fieldset legend="CÓDIGO ANTERIOR" style="font-size: 13px;" rendered="#{gestionPredios.optFiltro eq 5}">
                            <p:inputText id="codAnterior" placeholder="Código Anterior" title="Código Anterior : #{gestionPredios.predioModel.predialAnterior}" value="#{gestionPredios.predioModel.predialAnterior}" style="width: 40%"/>
                        </p:fieldset>
                        <p:commandButton id="btnConsultar" value="CONSULTAR" style="font-size: 15px; font-weight: bolder;" styleClass="btnStyle"  iconPos="right" actionListener="#{gestionPredios.consultar()}" update="frmPredios:dtPredios" action="#{gestionPredios.limpiarVariablesConsulta()}"/>
                        <p:commandButton id="fichaMz" value="IMPRIMIR MZ" style="font-size: 15px; font-weight: bolder;" styleClass="btnStyle" actionListener="#{gestionPredios.imprimirCatastroPredial1()}" rendered="#{gestionPredios.optFiltro eq 4}" />
                        <p:outputLabel rendered="#{gestionPredios.optFiltro ne 4}" />
                        <div class="ui-g-6 ui-md-6" style="width: 85% !important; text-align: right; float: right;">
                            <div class="ui-g-12 ui-md-6 ui-lg-3 colored" style="cursor: pointer;" onclick="activos();">Fichas Madres</div>
                            <div class="ui-g-12 ui-md-6 ui-lg-3 propiedadHorizontal" style="cursor: pointer;" onclick="inactivos();">Phs Hijas</div>
                            <div class="ui-g-12 ui-md-6 ui-lg-3 tarea" style="cursor: pointer;" onclick="inactivos();">Predios afectados por tarea</div>
                        </div>
                    </h:panelGrid>
                </p:tab>
                <p:tab title="GENERAR REPORTE" rendered="#{acesosFicha.editar()}" id="tab2"  >
                    <p:panelGrid id="pngReportes" styleClass="ui-responsive noBorder" style="width: 100%">
                        <center>
                            <p:selectOneMenu value="#{gestionPredios.tipoReporte}" style="width:425px;  font-weight: bold;">
                                <f:selectItem itemLabel="Seleccione..." itemValue="#{null}" />
                                <f:selectItem itemLabel="TOTAL DE PREDIOS REGISTRADOS POR USUARIO" itemValue="#{1}"/>
                                <f:selectItem itemLabel="TOTAL DE PREDIOS INGRESADOS" itemValue="#{2}"  rendered="#{appConfig.mainConfig.fichaPredial.redenerFichaIb}"/>
                                <f:selectItem itemLabel="INFORME DE PREDIOS MODIFICADOS POR USUARIO" itemValue="#{3}" rendered="#{appConfig.mainConfig.fichaPredial.redenerFichaIb}" />
                                <f:selectItem itemLabel="INFORME DE MODIFICACIONES POR FECHA" itemValue="#{4}" rendered="#{appConfig.mainConfig.fichaPredial.redenerFichaIb}" />
                                <!--<f:selectItem itemLabel="TOTAL DE PREDIOS REGISTRADOS POR PARROQUIA - ZONA - SECTOR - MZ" itemValue="#{5}"/>-->
                                <!--<f:selectItem itemLabel="TOTAL DE PREDIOS POR USO DEL SUELO" itemValue="#{6}"/>-->
                                <p:ajax update="frmPredios:tbConsultas"/>
                            </p:selectOneMenu>
                        </center>
                    </p:panelGrid>
                    <!-- tipoReporte ne null -->
                    <h:panelGrid rendered="#{gestionPredios.tipoReporte ne null}" id="pUsuarioReporte" styleClass="ui-responsive noBorder" style="width: 100%">
                        <p:row>
                            <p:column  rendered="#{gestionPredios.tipoReporte eq 4 or gestionPredios.tipoReporte eq 3 or gestionPredios.tipoReporte eq 2}">
                                <center>
                                    <p:outputLabel value="Fecha Desde" style="width: 100%;"/>
                                    <p:calendar value="#{gestionPredios.fecha}" navigator="true" pattern="dd/MM/yyyy" maxdate="sysdate" style="width: 100%;" />
                                    <p:spacer width="11"/>
                                    <p:outputLabel value="Fecha Hasta" style="width: 100%;"/>
                                    <p:calendar value="#{gestionPredios.fecha_hasta}" navigator="true" pattern="dd/MM/yyyy" maxdate="sysdate" style="width: 100%;" />
                                </center>
                            </p:column>
                        </p:row>
                        <p:row >
                            <p:column colspan="2">
                                <center>
                                    <p:outputLabel value="Usuarios:   " style="font-weight: bolder"/>
                                    <p:selectOneMenu  value="#{gestionPredios.user}"  style="width: 30%" effect="fade" converter="entityConverter" 
                                                      filter="true" filterMatchMode="contains" >
                                        <f:selectItem itemLabel="Todos" itemValue="#{null}"/>
                                        <f:selectItems value="#{gestionPredios.usuarios}" var="t" itemLabel="#{t.ente.nombres} #{t.ente.apellidos} - #{t.usuario}" itemValue="#{t}"/>
                                    </p:selectOneMenu>
                                </center>
                            </p:column>
                        </p:row>
                    </h:panelGrid>
                    <!--tipoReporte 4 o 5-->
                    <p:panelGrid rendered="#{gestionPredios.tipoReporte eq 5}" id="pPredioReporte" styleClass="ui-responsive noBorder" style="width: 100%" >
                        <p:row>
                            <p:column>
                                <p:outputLabel value="Nombre Parroquia: " style="font-weight: bolder"/>
                            </p:column>
                            <p:column><p:outputLabel value="ZONA" style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="SECTOR" style="font-size: 13px; font-weight: bolder;"/></p:column>
                            <p:column><p:outputLabel value="MANZANA" style="font-size: 13px; font-weight: bolder;"/></p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:selectOneMenu  value="#{gestionPredios.parroquia}"  style="width: 80%" effect="fade" converter="entityConverter"  
                                                  filter="true" filterMatchMode="contains"  >
                                    <f:selectItem itemLabel="Todos" itemValue="#{null}"/>
                                    <f:selectItems value="#{gestionPredios.parroquias}" var="t" itemLabel="#{t.descripcion}" itemValue="#{t}"/>
                                </p:selectOneMenu>
                            </p:column>
                            <center>
                                <p:column ><p:inputText onkeypress="validateIntegerValueAndFocusNext(event, '')" maxlength="3"  placeholder="Campo  Obligatorio" value="#{gestionPredios.p.zona}"/></p:column>
                                <p:column><p:inputText onkeypress="validateIntegerValueAndFocusNext(event, '')" maxlength="3"  placeholder="Campo  Obligatorio" value="#{gestionPredios.p.sector}"/></p:column>
                                <p:column><p:inputText onkeypress="validateIntegerValueAndFocusNext(event, '')" maxlength="3"  placeholder="Campo  Obligatorio" value="#{gestionPredios.p.mz}"/></p:column>
                            </center>
                        </p:row>
                    </p:panelGrid>
                    <!--tipoReporte eq 6-->
                    <p:panelGrid rendered="#{gestionPredios.tipoReporte eq 6}" id="pPredioReporteUsos" styleClass="ui-responsive noBorder" style="width: 100%" >
                        <h:panelGrid columns="2" style="width: 100%">
                            <comp:compInputSelect id="usoSolar" label="Uso del predio:" 
                                                  catalogo="predio-uso_solar" defaultValue="1"
                                                  bind="#{fichaPredial.predio.usoSolar}"/>

                        </h:panelGrid>
                        <p:commandButton id="btnReportere" value="IMPRIMIR" style="font-size: 15px; font-weight: bolder;" styleClass="btnStyle"  actionListener="#{gestionPredios.generarReportePredios()}" ajax="false" />
                    </p:panelGrid>
                    <br/>
                    <div align="center">
                        <p:commandButton id="btnReporte" value="IMPRIMIR" style="font-size: 15px; font-weight: bolder;" actionListener="#{gestionPredios.generarReportePredios()}" ajax="false" rendered="#{!appConfig.mainConfig.fichaPredial.redenerFichaIb and (gestionPredios.tipoReporte ne 1 and gestionPredios.tipoReporte ne null)}" />
                        <p:commandButton id="btnReporteIbarra" value="IMPRIMIR" style="font-size: 15px; font-weight: bolder;" actionListener="#{gestionPredios.imprimirReporte(gestionPredios.tipoReporte)}" ajax="false" rendered="#{appConfig.mainConfig.fichaPredial.redenerFichaIb}" />
                    </div>

                </p:tab>
                <p:tab title="INFORMACIÓN GENERAL" id="tab3" >
                    <p:fieldset legend="Totales de Predios" toggleable="true">
                        <h:panelGrid id="totales" columns="4" style="width: 100%"  >
                            <p:outputLabel  value="Total de Predios : #{gestionPredios.numPredios}" class="DispBlock Wid100 FontBold"/>
                            <p:outputLabel  value="Total de Predios Activos : #{gestionPredios.numPrediosActivos}" class="DispBlock Wid100 FontBold"/>
                            <p:outputLabel  value="Total de Predios Inactivos: #{gestionPredios.numPrediosInactivos}" class="DispBlock Wid100 FontBold"/>
                            <p:outputLabel  value="Total de Predios Históricos: #{gestionPredios.numPrediosHistorico}" class="DispBlock Wid100 FontBold"/>
                            <p:outputLabel  value="Total de Predios Privados: #{gestionPredios.numPrediosPrivados}" class="DispBlock Wid100 FontBold"/>
                            <p:outputLabel  value="Total de Predios Públicos: #{gestionPredios.numPrediosPublicos}" class="DispBlock Wid100 FontBold"/>
                            <p:outputLabel />
                            <p:outputLabel />
                        </h:panelGrid>
                        <h:panelGrid id="totalesPrediosUR" columns="2" style="width: 100%"  >
                            <p:outputLabel  value="Total de Predios Urbanos: #{gestionPredios.conteoPrediosUrbanos}" class="DispBlock Wid100 FontBold"/>
                            <p:outputLabel  value="Total de Predios Rurales: #{gestionPredios.conteoPrediosRurales}" class="DispBlock Wid100 FontBold"/>
                        </h:panelGrid>
                    </p:fieldset>

                    <br></br><br></br>
                    <p:fieldset legend="Totales de Avalúos" toggleable="true">
                        <h:panelGrid id="totalesAvaluos" columns="3" style="width: 100%"  >
                            <p:column>
                                <p:outputLabel  value="Total de Avalúos del Terreno: $ "/>
                                <p:outputLabel  value="#{gestionPredios.avaluosTerrenos}" class="DispBlock Wid100 FontBold">
                                    <f:convertNumber type="currency" currencySymbol="" locale="en_US" />
                                </p:outputLabel>
                            </p:column>
                            <p:column>
                                <p:outputLabel  value="Total de Avalúos del Construcción: $ "/>
                                <p:outputLabel  value="#{gestionPredios.avaluosConstruccion}" class="DispBlock Wid100 FontBold">
                                    <f:convertNumber type="currency" currencySymbol="" locale="en_US" />
                                </p:outputLabel>    
                            </p:column>

                            <p:column>
                                <p:outputLabel  value="Total de Avalúos de la Propiedad: $ "/>
                                <p:outputLabel  value="#{gestionPredios.avaluosPropiedad}" class="DispBlock Wid100 FontBold">
                                    <f:convertNumber type="currency" currencySymbol="" locale="en_US" />
                                </p:outputLabel>

                            </p:column>

                        </h:panelGrid>
                    </p:fieldset>

                </p:tab>
            </p:tabView>
            <p:dataTable id="dtPredios" value="#{gestionPredios.predios}" var="pt" widgetVar="preds" scrollable="true" paginator="true" resizableColumns="true"
                         emptyMessage="No se encontro ningun predio" rows="20" lazy="true" rowsPerPageTemplate="20,50,100" filterEvent="enter"
                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         selection="#{gestionPredios.predio}" rowKey="#{pt.id}" selectionMode="single"
                         rowStyleClass="#{pt.fichaMadre eq true? 'colored' : (pt.propiedadHorizontal eq true? 'propiedadHorizontal' : (pt.estaTarea eq true? 'tarea': null))}">
                <f:facet name="header">
                    <p:outputLabel value="Clic derecho en los registros, para mostrar opciones" 
                                   escape="false" class="Fs14" style="color: white"/>
                </f:facet>
                <p:column headerText="Tipo Predio" width="7%"  style="text-align: center; padding-left: 5px; padding-right: 5px;" sortBy="#{pt.tipoPredio}" rendered="#{empty gestionPredios.tipoPredio}" >
                    <p:outputLabel id="tipoPredio" value="#{appConfig.retornarValor(pt.tipoPredio)}"/>
                </p:column>
                <p:column headerText="# Predio" width="7%"  style="text-align: center; padding-left: 5px; padding-right: 5px;" filterStyle="width: 80%" filterBy="#{pt.numPredio}" sortBy="#{pt.numPredio}" filterMatchMode="contains">
                    <p:outputLabel id="numPredio" value="#{pt.numPredio}"/>
                    <p:tooltip id="toolTipContent" for="numPredio" trackMouse="true" style="max-width: 850px; min-width: 550px; font-size:9px !important;" >
                        <comp:preViewPredio predio="#{pt}" restriccionesPredio="#{gestionPredios.verificarRestriccion(pt.claveCat)}" />
                    </p:tooltip>
                </p:column>
                <p:column headerText="Parroq." style="text-align: center; width: 6%" filterBy="#{pt.parroquia}" sortBy="#{pt.parroquia}" filterStyle="width: 80%">
                    <p:outputLabel value="#{pt.parroquia}"  />
                </p:column>
                <p:column headerText="Zona" style="text-align: center; width: 3%" filterBy="#{pt.zona}" sortBy="#{pt.zona}" filterStyle="width: 80%">
                    <p:outputLabel value="#{pt.zona}"/>
                </p:column>
                <p:column headerText="Sect." style="text-align: center; width:4%" filterBy="#{pt.sector}" sortBy="#{pt.sector}" filterStyle="width: 80%">
                    <p:outputLabel value="#{pt.sector}"/>
                </p:column>
                <p:column headerText="Mz" style="text-align: center; width: 3%" filterBy="#{pt.mz}" sortBy="#{pt.mz}" filterStyle="width: 80%">
                    <p:outputLabel value="#{pt.mz}"/>
                </p:column>
                <p:column headerText="Predio" style="text-align: center; width: 3%" filterBy="#{pt.solar}"  sortBy="#{pt.solar}" filterStyle="width: 80%">
                    <p:outputLabel value="#{pt.solar}"/>
                </p:column>
                <p:column headerText="Bloque" style="text-align: center; width: 4%" filterBy="#{pt.bloque}"  sortBy="#{pt.bloque}" filterStyle="width: 80%">
                    <p:outputLabel value="#{pt.bloque}"/>
                </p:column>
                <p:column headerText="Piso" style="text-align: center; width: 3%" filterBy="#{pt.piso}"  sortBy="#{pt.piso}" filterStyle="width: 80%">
                    <p:outputLabel value="#{pt.piso}"/>
                </p:column>
                <p:column headerText="Unidad" style="text-align: center; width: 4%" filterBy="#{pt.unidad}"  sortBy="#{pt.unidad}" filterStyle="width: 80%">
                    <p:outputLabel value="#{pt.unidad}"/>
                </p:column>
                <p:column headerText="Cód. Catastral" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.claveCat}"/>
                </p:column>
                <p:column headerText="Cód. Anterior 1" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.predialant}"/>
                </p:column>
                <p:column headerText="Calle Princ." style="text-align: center; width: 10%" filterBy="#{pt.calle}" filterStyle="width: 90%">
                    <p:outputLabel id="calle" value="#{pt.calle}" title="Calle Principal: #{pt.calle} - Calle Secundaria: #{pt.calleS}" />
                </p:column>
                <p:column headerText="Propietarioa" style="text-align: center; width: 20%" sortBy="#{pt.catPredioPropietarioCollection.nombresCompletos}" >
                    <p:outputLabel id="props" value="#{gestionPredios.nombresPropietarios(pt)}"/>
                    <p:tooltip id="toolTipContent1" for="props" style="max-width: 850px; min-width: 550px; " >
                        <comp:preViewPredio predio="#{pt}" restriccionesPredio="#{gestionPredios.verificarRestriccion(pt.claveCat)}" />
                    </p:tooltip>
                </p:column>
                <p:column headerText="Área S./Alicuota" width="8%" style="text-align: center;">
                    <p:outputLabel value="#{pt.areaSolar}">
                        <f:convertNumber type="number" />
                    </p:outputLabel>
                </p:column>
                <p:column exportable="true" headerText="Área Construccion" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.areaDeclaradaConst}"/>
                </p:column>
                <p:column exportable="false" headerText="Estado" filterBy="#{pt.estado}" width="5%" filterMatchMode="exact" filterStyle="width: 50%" style="text-align: center">
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('preds').filter()" style="width: 70%">
                            <f:selectItem itemLabel="Estado" itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItem itemLabel="Activo" itemValue="A"/>
                            <f:selectItem itemLabel="Inactivo" itemValue="I"/>
                            <f:selectItem itemLabel="Historico" itemValue="H"/>
                            <f:selectItem itemLabel="Pendiente" itemValue="P"/>
                        </p:selectOneMenu>
                    </f:facet>
                    <p:outputLabel value="#{appConfig.retornarValor(pt.estado)}"/>
                </p:column>
                <p:column headerText="Tenencia" filterBy="#{pt.propiedad.nombre}" filterMatchMode="exact" filterStyle="width: 50%" style="text-align: center;  width: 15%" rendered="#{appConfig.mainConfig.fichaPredial.libertad}">
                    <f:facet name="filter">
                        <p:selectOneMenu id="tenencia" value=""  styleClass="selectWidth10" onchange="PF('preds').filter()" style="width: 70%; font-size: 10px">
                            <f:selectItem itemLabel="Tenencia" itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{gestionPredios.tiposPropiedad}" var="propiedad" itemLabel="#{propiedad.nombre}" itemValue="#{propiedad.nombre}" />
                        </p:selectOneMenu>
                    </f:facet>
                    <p:outputLabel value="#{pt.propiedad.nombre}"  style="font-size: 10px"/>
                </p:column>

                <p:column exportable="true" headerText="Barrio" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.ciudadela.nombre}"/>
                </p:column>
                <p:column exportable="true" headerText="Nombre Predio" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.nombreEdificio}"/>
                </p:column>
                <p:column exportable="true" headerText="Calle Principal" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.calle}"/>
                </p:column>
                <p:column exportable="true" headerText="Calle Secundaria" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.calleS}"/>
                </p:column>
                <p:column exportable="true" headerText="Placa Domiciliaria" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.numeroVivienda}"/>
                </p:column>
                <p:column exportable="true" headerText="Avaluo Terreno" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.avaluoSolar}">
                        <f:convertNumber type="currency" currencySymbol="" locale="en_US" />
                    </p:outputLabel>
                </p:column>
                <p:column exportable="true" headerText="Avaluo Edificacion" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.avaluoConstruccion}">
                        <f:convertNumber type="currency" currencySymbol="" locale="en_US" />
                    </p:outputLabel>
                </p:column>
                <p:column exportable="true" headerText="Avaluo Obras Internas" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.avaluoObraComplement}">
                        <f:convertNumber type="currency" currencySymbol="" locale="en_US" />
                    </p:outputLabel>
                </p:column>
                <p:column exportable="true" headerText="Valor Propiedad" width="100" styleClass="vd-hidden-column">
                    <p:outputLabel value="#{pt.avaluoMunicipal}">
                        <f:convertNumber type="currency" currencySymbol="" locale="en_US" />
                    </p:outputLabel>
                </p:column>
            </p:dataTable>
            <div align="center">
                <h:commandLink>
                    <p:commandButton ajax="false" id = "btnReporte" value="Exportar" icon="ui-icon-print" type="button" style="height: 30px" update=":frmPredios:dtPredios" />
                    <p:dataExporter type="xls" target="dtPredios" fileName="predios"   />
                </h:commandLink>
            </div>

            <p:contextMenu for="dtPredios" id="contexMenuPredios"  widgetVar="ctxMenu" beforeShow="return true;" style="width:180px" >
                <p:menuitem value="Editar" icon="ui-icon-pencil" actionListener="#{gestionPredios.ver(true)}" rendered="#{acesosFicha.editar()}"/>
                <p:menuitem value="Ver" icon="ui-icon-search" actionListener="#{gestionPredios.ver(false)}" rendered="true"/>

                <p:menuitem value="Transferencia dominio" icon="ui-icon-transferthick-e-w" actionListener="#{gestionPredios.transferenciaDominio()}" rendered="#{acesosFicha.trasnferenciaDominio()}" />
                <p:menuitem value="Ficha Completa" icon="ui-icon-print" actionListener="#{gestionPredios.imprimirFicha(false)}"  ajax="false" rendered="#{acesosFicha.imprimir()}"/>
                <p:menuitem value="Ficha Reducida" icon="ui-icon-print" actionListener="#{gestionPredios.fichaReducida()}"  ajax="false" rendered="#{acesosFicha.imprimir()}"/>

                <p:menuitem value="Historico" icon="ui-icon-refresh" actionListener="#{gestionPredios.verHistorial()}" oncomplete="PF('dlgHistorial').show()" update=":frmHistorico" rendered="#{acesosFicha.historico() and !appConfig.mainConfig.fichaPredial.libertad}"/>
            </p:contextMenu>
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
            </p:confirmDialog>
        </h:form>

        <p:dialog id="dlgHistorial" widgetVar="dlgHistorial" header="Historial de cambios" width="80%" appendTo="@(body)" modal="true" closable="true" closeOnEscape="true" responsive="true" dynamic="true">
            <h:form id="frmHistorico">
                <p:dataTable id="dtHistorico" value="#{gestionPredios.historico}" var="p" lazy="true" reflow="true" paginator="true" rows="10" rowsPerPageTemplate="10,25"
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             paginatorPosition="top" emptyMessage="No existen cambios registrados para este predio" widgetVar="dtHistorico">
                    <p:column headerText="Num. Predio" width="100" style="text-align: center">
                        <p:outputLabel value="#{p.predio}"/>
                    </p:column>
                    <p:column headerText="Actualizacion" width="200" style="text-align: center" sortBy="#{p.fecAct}">
                        <p:outputLabel value="#{p.fecAct}"/>
                    </p:column>
                    <p:column headerText="Observacion"  width="350" style="text-align: center">
                        <p:outputLabel value="#{p.observacion}"/>
                    </p:column>
                    <p:column headerText="Usuario" width="100" style="text-align: center">
                        <p:outputLabel value="#{p.usuario}"/>
                    </p:column>
                    <p:column headerText="Cambios" width="100" style="text-align: center" exportable="true" styleClass="vd-hidden-column">
                        <p:outputLabel value="#{p.cambios}"/>
                    </p:column>
                    <p:column style="text-align: center" width="100" exportable="false">
                        <p:commandButton id="btnVerHist" value="Ver" actionListener="#{gestionPredios.verFichaHistorico(p)}" oncomplete="PF('dlgHistorial').hide()"/>
                    </p:column>

                </p:dataTable>
                <div align="center">
                    <p:commandButton id="btnCerrarHist" value="Cerrar" onclick="PF('dlgHistorial').hide()" update="dtHistorico"/>
                    <h:commandLink title="Exporta a Excel Los datos del Historico">
                        <p:graphicImage name="/css/homeIconsImages/down.png" />
                        <p:dataExporter type="xls" target="dtHistorico" fileName="HistoricoPredios" />
                    </h:commandLink>
                </div>
            </h:form>
        </p:dialog>
        <p:dialog id="dlgSolicitante" widgetVar="dlgSolicitante" header="Listado de contribuyentes" appendTo="@(body)" width="80%" height="500" responsive="true" closable="true" closeOnEscape="true" modal="true" >
            <h:form id="frmSolicitante">
                <p:dataTable id="dtSolicitante" value="#{gestionPredios.propietarios}" var="s" selection="#{gestionPredios.propietario}"
                             rowKey="#{s.id}" style="width: 100%" lazy="true" reflow="true" paginator="true" rows="20"
                             selectionMode="single" filterEvent="enter" paginatorPosition="top" rowsPerPageTemplate="10, 20, 50" >
                    <f:facet name="header">Seleccione Contribuyente</f:facet>
                    <p:column headerText="No. Predio" filterBy="#{s.predio.numPredio}" filterMatchMode="equals" filterStyle="width: 95%;">
                        <p:outputLabel value="#{s.predio.numPredio}"/>
                    </p:column>

                    <p:column headerText="Cod.Catastral">
                        <p:outputLabel value="#{s.predio.claveCat}"/>
                    </p:column>
                    <p:column headerText="Cod.Urbanistico">
                        <p:outputLabel value="SEC:#{s.predio.sector}-Mz:#{s.predio.mz}-Sl:#{s.predio.solar}"/>
                    </p:column>

                    <p:column headerText="No. Identificacion" filterBy="#{s.ente.ciRuc}" filterMatchMode="contains" filterStyle="width: 95%;">
                        <p:outputLabel value="#{s.ente.ciRuc}"/>
                    </p:column>
                    <p:column headerText="Apellidos" filterBy="#{s.ente.apellidos}" filterMatchMode="contains" filterStyle="width: 95%;">
                        <p:outputLabel value="#{s.ente.apellidos}" style="text-transform: uppercase"/>
                    </p:column>
                    <p:column headerText="Nombres" filterBy="#{s.ente.nombres}" filterMatchMode="contains" filterStyle="width: 95%;">
                        <p:outputLabel value="#{s.ente.nombres}" style="text-transform: uppercase"/>
                    </p:column>
                    <p:column headerText="Razon Social" filterBy="#{s.ente.razonSocial}" filterMatchMode="contains" filterStyle="width: 95%;">
                        <p:outputLabel value="#{s.ente.razonSocial}" style="text-transform: uppercase"/>
                    </p:column>

                    <f:facet name="footer">
                        <p:commandButton id="btnSeleccionar" value="Seleccionar" update=":frmPredios:tbConsultas" style="height: 30px" oncomplete="PF('dlgSolicitante').hide()" actionListener="#{gestionPredios.seleccionarContribuyente()}"/>
                        <!--                        <f:facet name="{Exporters}">-->
                        <h:commandLink>
                            <p:commandButton ajax="false" id = "btnReporte" value="Reporte" icon="ui-icon-print" type="button" style="height: 30px" update=":frmPredios:tbConsultas" />
                            <p:dataExporter type="xls" target="dtSolicitante" fileName="predioPropietario"   />
                        </h:commandLink>
                    </f:facet>

                </p:dataTable>
            </h:form>
        </p:dialog>
        <p:dialog id="dlgDivision" widgetVar="dlgDivision" header="Division de Predios" appendTo="@(body)" dynamic="true" 
                  width="48%" height="450" responsive="true" closable="true" closeOnEscape="true" modal="true">
            <h:form id="frmDivision">
                <br/>
                <p:outputLabel value=""/><p:outputLabel value="Propietario: " style="font-weight: bolder"/>
                <p:outputLabel value="&#160;"/><p:outputLabel value="&#160;" />
                <p:outputLabel value=""/><p:inputText value="#{gestionPredios.predio.nombrePropietarios}" readonly="true" style="width: 50%"/>
                <p:outputLabel value="&#160;"/><p:outputLabel value="&#160;" />
                <p:outputLabel value="Área de Solar: " style="font-weight: bolder"/>
                <p:outputLabel value="&#160;"/><p:outputLabel value="&#160;" />
                <p:outputLabel value=""/><p:inputText value="#{gestionPredios.predio.areaSolar}" readonly="true" style="width: 20%"/>
                <p:panelGrid style="margin-top:20px" >
                    <f:facet name="header">
                        <p:row>
                            <p:column>Parroquia :   </p:column>
                            <p:column>Zona :        </p:column>
                            <p:column>Sector :      </p:column>
                            <p:column>Mz. :         </p:column>
                            <p:column>Lote :        </p:column>
                            <p:column rendered="#{gestionPredios.predio.propiedadHorizontal}">Bloque :      </p:column>
                            <p:column rendered="#{gestionPredios.predio.propiedadHorizontal}">Piso :        </p:column>
                            <p:column rendered="#{gestionPredios.predio.propiedadHorizontal}">Unidad :      </p:column>
                        </p:row>
                    </f:facet>
                    <p:row>
                        <p:column><p:inputText id="parrq" placeholder="Parroquia"  value="#{gestionPredios.predio.parroquia}" readonly="true" style="text-align: center; width: 89%" maxlength="2"/></p:column>
                        <p:column><p:inputText id="zona" placeholder="Zona" value="#{gestionPredios.predio.zona}" readonly="true" style="text-align: center; width: 89%" maxlength="2"/></p:column>
                        <p:column><p:inputText id="sect" placeholder="Sector"  value="#{gestionPredios.predio.sector}" readonly="true" style="text-align: center; width: 89%" maxlength="2"/></p:column>
                        <p:column><p:inputText id="mz" placeholder="Manzana"  value="#{gestionPredios.predio.mz}" readonly="true" style="text-align: center; width: 89%" maxlength="3"/></p:column>
                        <p:column><p:inputText id="lot" placeholder="Lote" value="#{gestionPredios.predio.solar}" readonly="true"  style="text-align: center; width: 89%" maxlength="3"/></p:column>
                        <p:column rendered="#{gestionPredios.predio.propiedadHorizontal}"><p:inputText id="blo" placeholder="Bloque"  value="#{gestionPredios.predio.bloque}" readonly="true" style="text-align: center; width: 89%" maxlength="2"/></p:column>
                        <p:column rendered="#{gestionPredios.predio.propiedadHorizontal}"><p:inputText id="piso" placeholder="Piso"  value="#{gestionPredios.predio.piso}" readonly="true" style="text-align: center; width: 89%" maxlength="3"/></p:column>
                        <p:column rendered="#{gestionPredios.predio.propiedadHorizontal}"><p:inputText id="uni" placeholder="Unidad" value="#{gestionPredios.predio.unidad}" readonly="true"  style="text-align: center; width: 89%" maxlength="3"/></p:column>
                    </p:row>

                </p:panelGrid>
                <br/>
                <div align="center" >
                    <p:commandButton value="Agregar" actionListener="#{gestionPredios.addDivisionPredio()}" update=":frmDivision:tblDivisionPredios" />
                </div>
                <br/>
                <p:dataTable id="tblDivisionPredios" value="#{gestionPredios.predioDivision}"
                             var="pd" editable="true" editMode="cell" widgetVar="prediosDivision">
                    <p:ajax event="cellEdit" listener="#{gestionPredios.validateAreaSolarDivisionCellRow}" update="frmDivision:tblDivisionPredios" />
                    <f:facet name="header">
                        <p:outputLabel value="Predios Resultantes"/>
                    </f:facet>
                    <p:column headerText="Parroquia" style="text-align: center">
                        <p:outputLabel value="#{pd.parroquia}"/>
                    </p:column>
                    <p:column headerText="Zona" style="text-align: center">
                        <p:outputLabel value="#{pd.zona}" />
                    </p:column>
                    <p:column headerText="Sector" style="text-align: center">
                        <p:outputLabel value="#{pd.sector}" />
                    </p:column>
                    <p:column headerText="Mz." style="text-align: center" >
                        <p:outputLabel value="#{pd.mz}" />
                    </p:column>
                    <p:column headerText="Lote"  style="text-align: center" >
                        <p:outputLabel value="#{pd.solar}"/>
                    </p:column>
                    <p:column rendered="#{gestionPredios.predio.propiedadHorizontal}" headerText="Bloque"  style="text-align: center" >
                        <p:outputLabel value="#{pd.bloque}"/>
                    </p:column>
                    <p:column rendered="#{gestionPredios.predio.propiedadHorizontal}"  headerText="Piso"  style="text-align: center" >
                        <p:outputLabel value="#{pd.piso}"/>
                    </p:column>
                    <p:column rendered="#{gestionPredios.predio.propiedadHorizontal}" headerText="Unidad"  style="text-align: center" >
                        <p:outputLabel value="#{pd.unidad}"/>
                    </p:column>
                    <p:column headerText="Área S. Correspondiente" style="text-align: center" >
                        <p:cellEditor id="celEdit">
                            <f:facet id="out" name="output"><p:outputLabel  value="#{pd.areaSolar}" /></f:facet>
                            <f:facet id="intext" name="input"><pe:inputNumber  value="#{pd.areaSolar}" style="width: 70%"  minValue="0"/></f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column headerText="Opción" style="text-align: center" >
                        <p:commandLink actionListener="#{gestionPredios.removePredioDivision(pd.solar)}" update=":frmDivision:tblDivisionPredios" >
                            <p:graphicImage id="grafDivDel" value="/css/homeIconsImages/delete.png"  height="20" width="20"/>
                        </p:commandLink>
                    </p:column>
                </p:dataTable>

                <br/>
                <div align="center" >
                    <p:commandButton value="Aceptar" actionListener="#{gestionPredios.saveDivisionPredio()}" update="frmEstatus" />
                    <p:spacer width="10"/>
                    <p:commandButton value="Cancelar" actionListener="#{gestionPredios.clearDivisionPredio()}" update=":frmDivision:tblDivisionPredios" oncomplete="PF('dlgDivision').hide()" />
                </div>
                <br/>

            </h:form>
        </p:dialog>

        <p:dialog id="dlgMatricula" widgetVar="dlgMatricula" header="Matriculas Inmobiliarias Generadas" width="350" height="150" closable="true" closeOnEscape="false" resizable="false" dynamic="true" >
            <h:form id="frmEstatus">

                <div align="center">
                    <p:dataTable value="#{gestionPredios.prediosResultantes}" var="pr" styleClass="borderless">
                        <p:column headerText="Matriculas Inmobiliarias"  style="text-align: center" >
                            <p:outputLabel value="#{pr.numPredio}"/>
                        </p:column>
                        <p:column headerText="Opcion"  style="text-align: center" >
                            <p:commandButton value="Continuar" actionListener="#{gestionPredios.continuar(pr)}"/>
                        </p:column>
                    </p:dataTable>
                </div>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
